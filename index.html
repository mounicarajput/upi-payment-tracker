<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPI Payment Tracker + Financial Recommendation</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      margin: 1.5rem auto;
      max-width: 480px;
      padding: 1rem;
      color: #333;
    }
    h2, h3 {
      color: #1f2937;
      margin-bottom: 0.75rem;
    }
    label {
      font-weight: 600;
      margin-top: 1rem;
      display: block;
      color: #4b5563;
    }
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 0.6rem 0.75rem;
      margin-top: 0.25rem;
      border-radius: 6px;
      border: 1.5px solid #d1d5db;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 6px #93c5fd;
    }
    button, a#payLink {
      margin-top: 1rem;
      background-color: #3b82f6;
      border: none;
      color: white;
      font-weight: 700;
      padding: 0.75rem 1.25rem;
      font-size: 1.1rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      display: inline-block;
      text-align: center;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    button:hover, a#payLink:hover {
      background-color: #2563eb;
    }
    button:disabled, a#payLink[disabled] {
      background-color: #9ca3af;
      cursor: not-allowed;
      pointer-events: none;
    }
    .category-buttons button {
      margin-right: 0.5rem;
      margin-top: 0.5rem;
      background-color: #e0e7ff;
      color: #4338ca;
      font-weight: 600;
      border-radius: 6px;
      padding: 0.45rem 0.9rem;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .category-buttons button:hover {
      background-color: #c7d2fe;
    }
    #categoryDiv {
      margin-top: 1.5rem;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.1);
    }
    .history, .recommendation {
      margin-top: 2rem;
      background: white;
      padding: 1rem 1.25rem;
      border-radius: 10px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.1);
    }
    #historyList {
      list-style: none;
      padding-left: 0;
      max-height: 160px;
      overflow-y: auto;
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #374151;
    }
    #historyList li {
      border-bottom: 1px solid #e5e7eb;
      padding: 0.3rem 0;
    }
    #monthFilter {
      margin-top: 0.3rem;
      max-width: 180px;
    }
    .toggle {
      margin-top: 1rem;
      font-weight: 600;
      user-select: none;
      color: #4b5563;
    }
    .recommendation table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.95rem;
    }
    .recommendation th, .recommendation td {
      border: 1px solid #e5e7eb;
      padding: 0.5rem 0.75rem;
      text-align: left;
    }
    .recommendation th {
      background-color: #e0e7ff;
      color: #4338ca;
    }
    .future-health {
      margin-top: 1rem;
      font-weight: 700;
      font-size: 1.1rem;
      color: #2563eb;
    }
  </style>
</head>
<body>
  <h2>UPI Payment + Category Tracker</h2>

  <form id="paymentForm" autocomplete="off">
    <label for="upiId">Receiver UPI ID:</label>
    <input type="text" id="upiId" placeholder="e.g. example@upi" required />

    <label for="name">Payee Name:</label>
    <input type="text" id="name" placeholder="e.g. Monika" required />

    <label for="amount">Amount (INR):</label>
    <input type="number" id="amount" placeholder="e.g. 100" required min="1" />

    <label for="note">Note:</label>
    <input type="text" id="note" placeholder="e.g. Food order" required />

    <label class="toggle">
      <input type="checkbox" id="useGpayLink" /> Use Google Pay Web URL (for iPhone)
    </label>

    <a id="payLink" href="#" disabled>Pay with UPI App</a>
  </form>

  <div id="categoryDiv" style="display:none;">
    <h3>Select Category:</h3>
    <div class="category-buttons">
      <button type="button" onclick="selectCategory('Food')">Food</button>
      <button type="button" onclick="selectCategory('Entertainment')">Entertainment</button>
      <button type="button" onclick="selectCategory('Petrol')">Petrol</button>
      <button type="button" onclick="selectCategory('Education')">Education</button>
    </div>
  </div>

  <div class="history">
    <h3>Transaction History</h3>
    <label for="monthFilter">Filter by Month:</label>
    <select id="monthFilter" onchange="loadHistory()">
      <option value="">All</option>
    </select>
    <ul id="historyList"></ul>
  </div>

  <!-- New Financial Recommendation Section -->
  <div class="recommendation">
    <h3>Financial Recommendation</h3>
    <label for="salaryInput">Monthly Salary (INR):</label>
    <input type="number" id="salaryInput" placeholder="Enter your monthly salary" min="0" />

    <label for="otherIncomeInput">Other Monthly Income (INR):</label>
    <input type="number" id="otherIncomeInput" placeholder="Enter other income if any" min="0" />

    <button id="calcRecommendation" type="button">Get Recommendation</button>

    <div id="recommendationResult" style="display:none; margin-top:1rem;">
      <h4>Spending Breakdown</h4>
      <table id="spendingTable">
        <thead>
          <tr>
            <th>Category</th><th>Spent (₹)</th><th>Recommended Budget (₹)</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="future-health" id="futureHealth"></div>
    </div>
  </div>

  <script>
    const payLink = document.getElementById("payLink");
    const form = document.getElementById("paymentForm");
    const useGpayLink = document.getElementById("useGpayLink");
    const categoryDiv = document.getElementById("categoryDiv");
    const historyList = document.getElementById("historyList");
    const monthFilter = document.getElementById("monthFilter");

    // Auto-check Google Pay URL for iPhone
    const isIphone = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    if (isIphone) {
      useGpayLink.checked = true;
      useGpayLink.disabled = true;
    }

    // Enable/disable pay button based on form input validation
    form.addEventListener("input", () => {
      const upiId = document.getElementById('upiId').value.trim();
      const name = document.getElementById('name').value.trim();
      const amount = document.getElementById('amount').value.trim();
      const note = document.getElementById('note').value.trim();

      if (upiId && name && amount && note) {
        payLink.removeAttribute("disabled");
      } else {
        payLink.setAttribute("disabled", true);
      }
    });

    payLink.addEventListener("click", function(e) {
      e.preventDefault();

      const upiId = document.getElementById('upiId').value.trim();
      const name = document.getElementById('name').value.trim();
      const amount = parseFloat(document.getElementById('amount').value.trim());
      const note = document.getElementById('note').value.trim();

      if (!upiId || !name || !amount || !note) return;

      if (useGpayLink.checked) {
        // Google Pay web link for iPhone
        this.href = `https://pay.google.com/intl/en_in/about/#upi?id=${encodeURIComponent(upiId)}&pn=${encodeURIComponent(name)}&tn=${encodeURIComponent(note)}&am=${amount.toFixed(2)}&cu=INR`;
      } else {
        // UPI link for Android or other
        this.href = `upi://pay?pa=${encodeURIComponent(upiId)}&pn=${encodeURIComponent(name)}&tn=${encodeURIComponent(note)}&am=${amount.toFixed(2)}&cu=INR`;
      }

      // Show category selector for this transaction
      categoryDiv.style.display = "block";

      // Store current transaction temporarily for category selection
      window.currentTransaction = {
        upiId, name, amount, note, category: null,
        date: new Date()
      };
    });

    function selectCategory(category) {
      if (!window.currentTransaction) return alert("Please initiate a payment first.");

      window.currentTransaction.category = category;

      // Save transaction to localStorage
      let transactions = JSON.parse(localStorage.getItem("upiTransactions") || "[]");
      transactions.push(window.currentTransaction);
      localStorage.setItem("upiTransactions", JSON.stringify(transactions));

      // Hide category div and clear current transaction
      categoryDiv.style.display = "none";
      window.currentTransaction = null;

      alert("Transaction saved with category: " + category);
      loadHistory();
      clearForm();
    }

    function clearForm() {
      form.reset();
      payLink.setAttribute("disabled", true);
    }

    function loadHistory() {
      let transactions = JSON.parse(localStorage.getItem("upiTransactions") || "[]");

      // Populate month filter dropdown with unique months from transactions
      let monthsSet = new Set();
      transactions.forEach(tx => {
        let date = new Date(tx.date);
        let monthKey = date.getFullYear() + "-" + (date.getMonth()+1).toString().padStart(2, '0');
        monthsSet.add(monthKey);
      });

      // Clear existing options except first "All"
      while (monthFilter.options.length > 1) {
        monthFilter.remove(1);
      }
      Array.from(monthsSet).sort((a,b) => b.localeCompare(a)).forEach(month => {
        let option = document.createElement("option");
        option.value = month;
        let [y,m] = month.split("-");
        option.text = new Date(y, m-1).toLocaleString('default', {month: 'long', year: 'numeric'});
        monthFilter.appendChild(option);
      });

      // Filter by selected month if any
      const selectedMonth = monthFilter.value;
      if (selectedMonth) {
        transactions = transactions.filter(tx => {
          let d = new Date(tx.date);
          let key = d.getFullYear() + "-" + (d.getMonth()+1).toString().padStart(2, '0');
          return key === selectedMonth;
        });
      }

      // Render list
      historyList.innerHTML = "";
      if (transactions.length === 0) {
        historyList.innerHTML = "<li>No transactions found.</li>";
        return;
      }
      transactions.forEach(tx => {
        let d = new Date(tx.date);
        historyList.innerHTML += `<li><strong>${tx.category || 'Uncategorized'}</strong>: ₹${tx.amount.toFixed(2)} to ${tx.name} (${tx.upiId}) - ${tx.note} <br/><small>${d.toLocaleDateString()} ${d.toLocaleTimeString()}</small></li>`;
      });
    }

    // Initial load of history
    loadHistory();

    // --- Financial Recommendation Logic ---

    const salaryInput = document.getElementById("salaryInput");
    const otherIncomeInput = document.getElementById("otherIncomeInput");
    const calcRecommendation = document.getElementById("calcRecommendation");
    const recommendationResult = document.getElementById("recommendationResult");
    const spendingTableBody = document.querySelector("#spendingTable tbody");
    const futureHealthDiv = document.getElementById("futureHealth");

    // Recommended % budget per category of total income
    const recommendedBudgetsPercent = {
      Food: 0.15,
      Entertainment: 0.10,
      Petrol: 0.07,
      Education: 0.05,
      Fun: 0.05,
      Vacation: 0.05,
      Savings: 0.30,
      Stocks: 0.10,
      Tax: 0.13
    };

    // Calculate total spent per category from transactions
    function calculateSpending() {
      let transactions = JSON.parse(localStorage.getItem("upiTransactions") || "[]");
      // Include categories we want to show, even if zero
      let categories = Object.keys(recommendedBudgetsPercent);
      let spent = {};
      categories.forEach(c => spent[c] = 0);

      transactions.forEach(tx => {
        // Use category if exists in recommendedBudgetsPercent else add to 'Fun' by default
        let cat = tx.category;
        if (!cat || !categories.includes(cat)) cat = "Fun";
        spent[cat] = (spent[cat] || 0) + tx.amount;
      });
      return spent;
    }

    calcRecommendation.addEventListener("click", () => {
      let salary = parseFloat(salaryInput.value);
      let otherIncome = parseFloat(otherIncomeInput.value);
      if (isNaN(salary) || salary < 0) return alert("Please enter valid Salary");
      if (isNaN(otherIncome) || otherIncome < 0) otherIncome = 0;

      const totalIncome = salary + otherIncome;

      const spent = calculateSpending();

      // Clear previous rows
      spendingTableBody.innerHTML = "";

      // Show spending and recommended budgets
      Object.entries(recommendedBudgetsPercent).forEach(([cat, percent]) => {
        const spentAmount = spent[cat] || 0;
        const recommendedAmount = totalIncome * percent;

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${cat}</td>
          <td>₹${spentAmount.toFixed(2)}</td>
          <td>₹${recommendedAmount.toFixed(2)}</td>
        `;
        spendingTableBody.appendChild(row);
      });

      // Simple future bank health forecast
      // Calculate total spent tracked (only categories we consider)
      let totalSpent = 0;
      for (let key in spent) totalSpent += spent[key];

      // Calculate savings: income - total spent - tax
      // Tax assumed 13% of income, but we use recommended tax budget here
      const taxBudget = totalIncome * recommendedBudgetsPercent.Tax;
      const savings = totalIncome - totalSpent - taxBudget;

      let healthMessage = "";
      if (savings > totalIncome * 0.15) {
        healthMessage = "Your bank account health is good! Keep saving consistently.";
        futureHealthDiv.style.color = "#15803d"; // green
      } else if (savings > 0) {
        healthMessage = "Your savings are moderate. Try to reduce discretionary spending.";
        futureHealthDiv.style.color = "#ca8a04"; // amber
      } else {
        healthMessage = "Warning: Your expenses exceed your income! Review your budget urgently.";
        futureHealthDiv.style.color = "#b91c1c"; // red
      }

      futureHealthDiv.textContent = healthMessage;
      recommendationResult.style.display = "block";
    });
  </script>
</body>
</html>
